모든 객체를 한 맵에 로드해 각 객체가 한 번씩만 로드되게 한다. 객체를 참조할 때는 맵을 이용해 객체를 조회한다.

단일 비즈니스 트랜잭션이 데이터베이스에서 읽은 모든 객체에 대한 기록을 보관한다.

## 작동 원리

기본 개념은 데이터 베이스에서 읽은 객체를 포함하는 일련의 맵을 유지 관리

- 데이터 베이스 객체를 로드할 때는 먼저 맵을 확인하고 객체가 맵에 있으면 일치하는 객체를 반환
- 일치하는 객체가맵에 없으면 객체를 데이터베이스에서 읽고, 읽은 객체를 맵에 저장

### 키의 선택

해당 데이터 베이스 테이블의 기본 키를 사용

- 키가 단일 열이고 읽기 전용인 경우 적합

대리 기본키를 사용

### 명시적 또는 범용

명시적 식별자 맵

- 필요한 각 종류의 객체에 대한 고유한 메서드를 통해 접근
- ex.) findPerson(1)
- 엄격한 형식의 언어에서 컴파일 타임 검사가 지원
- 명시적 인터페이스의 다른 모든 장점을 가지고 있다.
  - 어떤 맵을 어떻게 사용해야 하는지 알기 쉽다.

범용 맵

- 필요한 객체의 종류를 매개변수 등을 통해 지정하고 단일 메서드를 통해 종류의 객체에 접근
- ex.) find(”Person”, 1)
  - 재사용 가능한 범용 객체로 범용 맵을 지원할 수 있다.

### 식별자 맵의 수

맵을 클래스당 하나씩 사용할지, 아니면 전체 세션에 하나만 사용할지 결정

- 세션당 단일 맵은 데이터베이스 고유 키가 있을 때만 선택할 수 있다.

맵이 여러개인 경우 맵을 클래스 또는 테이블 별로 하나씩 사용할 수 있다.

- 데이터 베이스 스키마와 객체 모델일 동일한 경우 적절
- 서로 다른 경우 객체를 바탕으로 맵을 만드는 것이 쉽다.
  - 객체 매핑의 복잡한 세부 사항을 알 필요가 없다.
- 별도의 맵을 만들변 상속의 경우 조회할 때마다 상속 객체에 대한 모든 맵을 찾아봐야 하므로 다형성 참조가 까다롭다.
  - 각 상속 트리에 단일 맵을 사용 (단일 맵)

### 식별자 맵의 위치

식별자 맵은 쉽게 찾을 수 있는 곳에 있어야 한다.

현재 작업 중인 프로세스 컨텍스트와 연결되는데, 각 세션은 다른 세션 인스턴스로부터 격리된 각자의 인스턴스를 가져야 한다.

- 작업 단위가 있다면 식별자 맵을 저장할 수 있는 최적의 위치
- 작업 단위가 없다면 세션과 연결된 레지스트리가 가장 적합

예외

- 관계형 데이터베이스를 레코드 데이터에 사용하더라도, 객체 데이터베이스를 트랜잭션 캐시로 사용하는 경우
- 객체가 항상 읽기 전용인 경우
  - 읽기 전용 식별자 맵을 프로세스 컨텍스트에 보관하고, 업데이트 기능 식별자 맵을 세션 컨텍스트에 보관

## 사용 시점

식별자 맵은 데이터베이스에서 가져오고 수정하는 객체를 관리하는 데 사용

- 인메모리 객체 2개가 동일한 데이터베이스 레코드와 연결되는 상황을 방지하기 위함
- 읽기 캐시로 동작해 동일한 데이터를 매번 데이터베이스에서 읽을 필요가 없어짐

### 예시 코드

[트랜잭션 스크립트](../../enterprise_architecture/src/main/java/org/example/chap11/uniquemap/).
